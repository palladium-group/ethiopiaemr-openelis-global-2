# Override file for Let's Encrypt certificate support
# Usage: docker compose -f dev.docker-compose.yml -f docker-compose.letsencrypt.yml up -d
#
# Certificates must be generated first: ./scripts/generate-letsencrypt-certs.sh
# Env: LETSENCRYPT_EMAIL (required for generation), LETSENCRYPT_DOMAIN (default storage.openelis-global.org)
#
# Override must list all proxy volumes (Compose replaces, not merges). Entrypoint symlinks
# LE certs from /etc/letsencrypt/live/$DOMAIN/ into nginx paths when present.

services:
    proxy:
        volumes:
            - certs-vol:/etc/nginx/certs/
            - keys-vol:/etc/nginx/keys/
            - ./volume/nginx/nginx.conf:/etc/nginx/nginx.conf:ro
            - ./volume/nginx/certbot:/var/www/certbot
            - ./volume/letsencrypt:/etc/letsencrypt:ro
            - ./nginx-proxy/docker-entrypoint.sh:/docker-entrypoint.sh:ro
        environment:
            - LETSENCRYPT_DOMAIN=${LETSENCRYPT_DOMAIN:-storage.openelis-global.org}
        entrypoint: ["/bin/sh", "/docker-entrypoint.sh"]
